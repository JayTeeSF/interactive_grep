#!/usr/bin/env ruby

# the "i" is for interactive
begin
  require 'rubygems'
  gem 'interactive_grep'
rescue LoadError
end
file_or_gem = File.expand_path( '../../lib/interactive_grep/grepper.rb', __FILE__ )
file_or_gem = 'interactive_grep' unless File.exists?( file_or_gem )
require file_or_gem

# TODO: replace this w/ a real cmd-line options parser!
if 0 == ARGV.size || InteractiveGrep::Grepper.contains_option?(ARGV,'h')
  puts InteractiveGrep::Grepper.usage
end

pattern = nil; interactive = true

in_file = ARGV[0]

if 2 <= ARGV.size
  pattern = ARGV[1]
end

if 3 <= ARGV.size
  mode = case ARGV[2]
         when /^i/i
           interactive = true
           "interactive"
         when /^c/i
           interactive = false
           "count"
         else
           interactive = false
           "normal"
         end
end

mode ||= interactive ? "interactive" : "normal"
igrep = InteractiveGrep::Grepper.new( { "files" => in_file, "pattern" => pattern, "mode" => mode, "verbose" => "true" } )

puts "Welcome..." if interactive
igrep.run()

exit
